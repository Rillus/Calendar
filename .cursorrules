# Circular Calendar Project Rules

## Project Context

This is a circular calendar visualisation built with vanilla JavaScript and SVG. The project uses ES6 modules and requires a local web server to run.

## Architecture Principles

1. **Modular Structure**: Code is split into focused modules:
   - `src/config/config.js` - Constants and configuration only
   - `src/utils/colorUtils.js` - Colour conversion utilities
   - `src/utils/mathUtils.js` - Mathematical helper functions
   - `src/utils/svgUtils.js` - SVG path creation
   - `src/renderer/calendarRenderer.js` - Rendering logic
   - `src/main.js` - Initialisation and orchestration
   - `tests/` - All test files

2. **Single Responsibility**: Each module should have one clear purpose

3. **ES6 Modules**: Always use `import`/`export` syntax. Never bundle unless explicitly requested.

4. **No External Dependencies**: Keep the project dependency-free. If D3.js is needed later, it will be added explicitly.

## Code Style

- **Language**: Use British English spelling (colour, centre, visualisation, etc.)
- **Variables**: Use `const` and `let`, never `var`
- **Functions**: Prefer arrow functions for callbacks, regular functions for main logic
- **Naming**: Use descriptive, camelCase names
- **Comments**: Comment complex logic, especially mathematical operations

## File Organisation

- Keep related functionality together
- Export only what's needed from each module
- Import only what you use
- Maintain clear separation between utilities and rendering logic

## SVG Best Practices

- Use SVG elements, not Canvas
- Leverage SVG's DOM structure for interactivity
- Use `viewBox` for responsiveness
- Keep paths and transformations efficient

## Testing Strategy

**TDD (Test-Driven Development) is required for this project.**

1. **Write tests first**: Before implementing any feature or fixing a bug, write the test(s) first
2. **Red-Green-Refactor cycle**: 
   - Red: Write a failing test
   - Green: Write the minimum code to make it pass
   - Refactor: Improve the code while keeping tests green
3. **Test coverage**: Aim for high coverage of utility functions and core logic
4. **Unit tests**: Use Vitest for unit testing utility functions (mathUtils, colorUtils, svgUtils)
5. **Integration tests**: Test calendar rendering and interactions where possible

### Testing Tools

- **Vitest**: Primary testing framework for unit tests
- **ES6 Modules**: Tests use the same module system as the codebase
- **Browser Testing**: Manual testing in modern browsers (Chrome, Firefox, Safari, Edge)
- **Responsive Testing**: Ensure responsive design works at different viewport sizes

### Test File Organisation

- Test files are located in the `tests/` directory
- Naming convention: `*.test.js` or `*.spec.js`
- Example: `tests/mathUtils.test.js` tests `src/utils/mathUtils.js`
- Import paths should use relative paths from test files to source files

## When Adding Features

**Always follow TDD workflow:**

1. **Write tests first**: Create test file(s) with failing tests for the new feature
2. **Implement feature**: Write minimum code to pass tests
3. **Refactor**: Improve code while keeping tests green
4. **Update tests**: Add edge cases and integration tests as needed

### Feature Planning

1. **Zoom Levels**: Plan for year → month → week → day navigation
2. **D3.js Integration**: When adding D3.js, maintain the existing SVG structure
3. **Date Information**: Consider how to display dates at different zoom levels
4. **Performance**: Keep rendering efficient, especially with many segments

### Testing New Features

- Unit test utility functions (math, colour, SVG operations)
- Test edge cases and error handling
- Integration tests for rendering logic where feasible
- Manual browser testing for visual/interactive features

## Common Patterns

- Calendar state (data, labels, colours) lives in `src/renderer/calendarRenderer.js`
- Mathematical calculations go in `src/utils/mathUtils.js`
- Colour operations go in `src/utils/colorUtils.js`
- SVG path generation goes in `src/utils/svgUtils.js`
- Configuration changes go in `src/config/config.js`

## Avoid

- **Writing code without tests first** (TDD violation)
- Bundling code unless explicitly requested
- Adding unnecessary dependencies (except testing tools)
- Mixing concerns (e.g., math in renderer, rendering in utils)
- Breaking the modular structure
- Using Canvas instead of SVG
- Skipping tests for utility functions

## Future Considerations

- D3.js will be added for custom interactivities as needed
- Zoom levels will require state management
- Date information will need a data structure
- Events/calendar data will need integration points

